<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      03 Install an Ingress Controller &middot; Microservices with AKS
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="category">

    <div id="sidebar">
  <header>
    <div>
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Microservices with AKS
      </a>
    </div>
    <p class="lead">Create microservices with Azure Kubernetes Service</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
      <a class="page-link "
          href="/about.html">About</a>
    
  

  
    
  

  

  
    
  


  


  
    
      <a class="category-link "
          href="/category/01_install_aks.html">01 Install Azure Kubernetes Service</a>
    
  

  
    
      <a class="category-link "
          href="/category/02_install_helm.html">02 Install Helm on Windows</a>
    
  

  
    
      <a class="category-link  active"
          href="/category/03_install_ingress.html">03 Install an Ingress Controller</a>
    
  

  
    
      <a class="category-link "
          href="/category/04_install_cert_mgr.html">04 Install HTTPS Certificates</a>
    
  

  
    
      <a class="category-link "
          href="/category/05_install_security_gateway.html">05 Install Security Gateway</a>
    
  

  
    
      <a class="category-link "
          href="/category/06_api_services.html">06 API Services</a>
    
  

  
    
      <a class="category-link "
          href="/category/07_messaging_service.html">07 Messaging Service</a>
    
  

  
    
      <a class="category-link "
          href="/category/08_composite_ui.html">08 Composite UI Frontend</a>
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  <hr>
  <p>
  &copy; 2018.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="page-title">03 Install an Ingress Controller</h1>
</header>
<div class="content">
  
  <p>An ingress controller is a piece of software that provides reverse proxy, configurable traffic routing. Kubernetes ingress resources are used to configure the ingress rules and routes for individual Kubernetes services. Using an ingress controller and ingress rules, a single external address can be used to route traffic to multiple services in a Kubernetes cluster.</p>

<h2 id="install-nginx-ingress-controller-with-helm">Install NGINX Ingress Controller with Helm</h2>

<p>Update the Helm repository</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm repo update
</code></pre></div></div>

<p>Install the nginx ingress controller with RBAC disabled</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm <span class="nb">install</span> <span class="nt">--name</span> nginx-ing stable/nginx-ingress <span class="nt">--set</span> rbac.create<span class="o">=</span><span class="nb">false</span> <span class="nt">--namespace</span> kube-system
</code></pre></div></div>

<p>NGINX ingress controller should now be installed in your cluster. Azure AKS automatically adds a load balancer called Kubernetes and a public IP.</p>

<p><img src="https://raw.githubusercontent.com/rcl-microservices-aks/documentation/master/images/ingress/ingress-1.PNG" alt="placeholder" title="Image" /></p>

<p>Run the following command to see the services running in the cluster in the kube-system namespace</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get services <span class="nt">--namespace</span> kube-system
</code></pre></div></div>

<p>Output:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME                                      TYPE           CLUSTER-IP     EXTERNAL-IP    PORT<span class="o">(</span>S<span class="o">)</span>                      AGE
heapster                                  ClusterIP      10.0.195.50    &lt;none&gt;         80/TCP                       2h
kube-dns                                  ClusterIP      10.0.0.10      &lt;none&gt;         53/UDP,53/TCP                2h
kubernetes-dashboard                      ClusterIP      10.0.58.84     &lt;none&gt;         80/TCP                       2h
nginx-ing-nginx-ingress-controller        LoadBalancer   10.0.141.187   23.100.26.95   80:30459/TCP,443:31810/TCP   11m
nginx-ing-nginx-ingress-default-backend   ClusterIP      10.0.42.127    &lt;none&gt;         80/TCP                       11m
tiller-deploy                             ClusterIP      10.0.115.145   &lt;none&gt;         44134/TCP                    56m
</code></pre></div></div>

<p>You will see the nginx controller that can be accessed from the internet (type: LoadBalancer) with an external IP assigned. You will also see the an nginx default backend that runs inside the cluster an cannot be accessed form the internet (type: ClusterIP). The Load Balancer will route traffick to the default backend. If you navigate to the external IP you will see the nginx default backend in the browser.</p>

<p><img src="https://raw.githubusercontent.com/rcl-microservices-aks/documentation/master/images/ingress/ingress-2.PNG" alt="placeholder" title="Image" /></p>

<h2 id="increasing-the-nginx-proxy-buffer-size">Increasing the NGINX Proxy Buffer Size</h2>

<p>The NGINX ingress controller Proxy Buffer Size is not large enough for the headers returned from some services. You will need to increase the buffer size. Create a ConfigMap file called ‘nginx-configuration.yaml’ add this code. Replace the placeholder text with your nginx pod name.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kind: ConfigMap  
apiVersion: v1  
metadata:  
  name: <span class="o">&lt;&lt;</span><span class="no">your</span><span class="sh">-nginx-pod-name&gt;&gt;
  namespace: kube-system
data:  
  proxy-buffer-size: "16k"
</span></code></pre></div></div>

<p>You can get the pod name for nginx with the following command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods <span class="nt">--namespace</span> kube-system
</code></pre></div></div>

<p>Output:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME                                                       READY     STATUS    RESTARTS   AGE
heapster-6599f48877-zj927                                  2/2       Running   0          2h
kube-dns-v20-7c556f89c5-5w5d2                              3/3       Running   0          2h
kube-dns-v20-7c556f89c5-fk8st                              3/3       Running   0          2h
kube-proxy-zksb6                                           1/1       Running   0          2h
kube-svc-redirect-4zr5z                                    1/1       Running   0          2h
kubernetes-dashboard-546f987686-v2g9v                      1/1       Running   0          2h
nginx-ing-nginx-ingress-controller-56b8ff549-6lshm         1/1       Running   0          27m
nginx-ing-nginx-ingress-default-backend-7f6dc6f7c4-dw5h4   1/1       Running   0          27m
omsagent-zt84m                                             1/1       Running   1          2h
tiller-deploy-5dd4f7b964-qz4rk                             1/1       Running   0          28m
tunnelfront-df6544c87-c6vv9                                1/1       Running   0          2h
</code></pre></div></div>

<p>CD into the folder where you saved the ConfigMap and run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> nginx-configuration.yaml 
</code></pre></div></div>

<p>The nginx ingress controller will be updated and restarted with the new configuration value for the proxy buffer size.</p>





  <section class="comments">
    <h2>Comments</h2>
    
  <p>
    You are seeing this because your Disqus shortname is not properly set. To
    configure Disqus, you should edit your <code>_config.yml</code> to include
    either a <code>disqus.shortname</code> variable.
  </p>

  <p>
    If you do not wish to use Disqus, override the
    <code>comments.html</code> partial for this theme.
  </p>


  </section>


</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
